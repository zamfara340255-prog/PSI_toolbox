# -*- coding: utf-8 -*-import jsonimport osimport tkinter as tkfrom tkinter import messagebox, filedialog, simpledialogfrom datetime import datetime, timedeltaimport tkinter.ttk as ttkfrom core.utils import tbfrom core.base_module import CalcModule# –ü–æ–ø—ã—Ç–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ openpyxl –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Exceltry:    import openpyxl    from openpyxl.styles import Font, Alignment, Border, Side, PatternFill    EXCEL_AVAILABLE = Trueexcept ImportError:    EXCEL_AVAILABLE = False# –§–∞–π–ª –±–∞–∑—ã –∑–Ω–∞–Ω–∏–πCUSTOM_STEPS_FILE = "custom_steps.json"DEFAULT_IMPACTS = [    "–ù–∞—á–∞–ª—å–Ω–∞—è —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ (–ù–ö–£)",    "–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —Å—Ä–µ–¥—ã (-50...+65¬∞C)",    "–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Å—Ä–µ–¥—ã (+50¬∞C)",    "–ü–æ–Ω–∏–∂–µ–Ω–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Å—Ä–µ–¥—ã (-10¬∞C)",    "–í—ã–¥–µ—Ä–∂–∫–∞ –≤ –ù–ö–£ (–ø–∞—É–∑–∞)",    "–í–∏–±—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –Ω–∞–≥—Ä—É–∑–∫–∏ (25 –ì—Ü, 2g)",    "–ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä",    "–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –≤–ª–∞–∂–Ω–æ—Å—Ç—å",    "–ü–æ–Ω–∏–∂–µ–Ω–Ω–æ–µ –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ",    "–ó–∞–≤–µ—Ä—à–∞—é—â–∞—è —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ (–ù–ö–£)"]def parse_time_input(val_str):    """–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å—Ç—Ä–æ–∫—É (1.5 –∏–ª–∏ 1:30) –≤ —á–∞—Å—ã (float)."""    val_str = str(val_str).strip().replace(",", ".")    if not val_str: return 0.0    if ":" in val_str:        parts = val_str.split(":")        h = float(parts[0]) if parts[0] else 0.0        m = float(parts[1]) if len(parts) > 1 and parts[1] else 0.0        return h + m / 60.0    else:        return float(val_str)def format_time_display(hours_float):    """–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —á–∞—Å—ã –∫–∞–∫ '1—á 30–º'"""    if hours_float == 0: return "0"    total_m = int(round(hours_float * 60))    h = total_m // 60    m = total_m % 60    if h > 0 and m > 0: return f"{h}—á {m:02}–º"    elif h > 0: return f"{h}—á"    else: return f"{m} –º–∏–Ω"class TestScheduleTab:    def __init__(self, parent_notebook, tab_name, master_module):        self.name = tab_name        self.master = master_module        self.steps = []         self.notebook = parent_notebook                self.frame = tb.Frame(parent_notebook, padding=10)        parent_notebook.add(self.frame, text=tab_name)                self.impact_types = list(DEFAULT_IMPACTS)        self.load_custom_impacts()                self.var_show_speed = tk.BooleanVar(value=False)        self.col_headers = {            "num": "‚Ññ",            "name": "–í–∏–¥ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è",            "speed": "–°–∫–æ—Ä. –ø–µ—Ä–µ—Ö–æ–¥–∞",            "time": "–í—Ä–µ–º—è (—á:–º)",            "cycles": "–¶–∏–∫–ª—ã",            "nku": "–ù–ö–£ (—á:–º)",            "total": "–ò—Ç–æ–≥–æ"        }        self._build_ui()    def _build_ui(self):        # 1. –ü–ê–ù–ï–õ–¨ –ù–ê–°–¢–†–û–ï–ö        opts = tb.Frame(self.frame)        opts.pack(fill="x", pady=(0, 5))        tb.Checkbutton(opts, text="–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞", variable=self.var_show_speed,                        bootstyle="round-toggle", command=self.toggle_speed_col).pack(side="left")        # 2. –¢–ê–ë–õ–ò–¶–ê        style = ttk.Style()        style.configure("Treeview", font=("Segoe UI", 10), rowheight=32)        style.configure("Treeview.Heading", font=("Segoe UI", 10, "bold"))        cols = ("num", "name", "speed", "time", "cycles", "nku", "total")        self.tree = tb.Treeview(self.frame, columns=cols, show="headings", selectmode="browse", height=12)                for col in cols:            self.tree.heading(col, text=self.col_headers[col], command=lambda c=col: self.sort_col(c, False))        self.tree.column("num", width=40, anchor="center")        self.tree.column("name", width=300, anchor="w")        self.tree.column("speed", width=100, anchor="center")        self.tree.column("time", width=80, anchor="center")        self.tree.column("cycles", width=60, anchor="center")        self.tree.column("nku", width=80, anchor="center")        self.tree.column("total", width=100, anchor="center")        if not self.var_show_speed.get():            self.tree.column("speed", width=0, stretch=False)        sb = tb.Scrollbar(self.frame, orient="vertical", command=self.tree.yview)        self.tree.configure(yscrollcommand=sb.set)                self.tree.pack(side="top", fill="both", expand=True)        sb.pack(side="right", fill="y", in_=self.tree)        self.tree.bind("<Double-1>", self.on_double_click)        self.tree.tag_configure("total_row", background="#cfd8dc", font=("Segoe UI", 11, "bold"))        # 3. –£–ü–†–ê–í–õ–ï–ù–ò–ï        ctrl = tb.Frame(self.frame, padding=(0, 10))        ctrl.pack(fill="x")        tb.Button(ctrl, text="‚ñ≤", bootstyle="secondary-outline", width=4, command=lambda: self.move_row(-1)).pack(side="left", padx=2)        tb.Button(ctrl, text="‚ñº", bootstyle="secondary-outline", width=4, command=lambda: self.move_row(1)).pack(side="left", padx=2)        tb.Button(ctrl, text="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É", bootstyle="danger-outline", command=self.delete_step).pack(side="left", padx=15)        tb.Label(ctrl, text="(–î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è –ø—Ä–∞–≤–∫–∏)", font=("Segoe UI", 9), bootstyle="secondary").pack(side="right")        # 4. –î–û–ë–ê–í–õ–ï–ù–ò–ï        add_box = tb.Labelframe(self.frame, text="–î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–ø", padding=10, bootstyle="primary")        add_box.pack(fill="x")                f_in = tb.Frame(add_box)        f_in.pack(fill="x")        # –ù–∞–∑–≤–∞–Ω–∏–µ        self.var_add_name = tk.StringVar()        self.cb_name = tb.Combobox(f_in, textvariable=self.var_add_name, values=self.impact_types, height=10)        self.cb_name.pack(side="left", fill="x", expand=True, padx=5)        tb.Button(f_in, text="+", width=3, bootstyle="info-outline", command=self.save_new_impact_type).pack(side="left")        # –ü–æ–ª—è        self.var_add_t = tk.StringVar(value="1:00")        self.var_add_c = tk.StringVar(value="1")        self.var_add_nku = tk.StringVar(value="0:00")        self.var_add_spd = tk.StringVar(value="")        self._mk_entry(f_in, "–°–∫–æ—Ä.:", self.var_add_spd, 8)        self._mk_entry(f_in, "–í—Ä–µ–º—è:", self.var_add_t, 6)        self._mk_entry(f_in, "–¶–∏–∫–ª—ã:", self.var_add_c, 4)        self._mk_entry(f_in, "–ù–ö–£:", self.var_add_nku, 6)        tb.Button(f_in, text="–î–æ–±–∞–≤–∏—Ç—å", bootstyle="success", command=self.add_step_ui).pack(side="left", padx=15)    def _mk_entry(self, parent, lbl, var, w):        f = tb.Frame(parent)        f.pack(side="left", padx=5)        tb.Label(f, text=lbl, font=("Segoe UI", 8)).pack(side="left")        tb.Entry(f, textvariable=var, width=w).pack(side="left", padx=2)    def toggle_speed_col(self):        if self.var_show_speed.get():            self.tree.column("speed", width=120, stretch=True)        else:            self.tree.column("speed", width=0, stretch=False)    def on_double_click(self, event):        region = self.tree.identify("region", event.x, event.y)        if region == "heading":            col = self.tree.identify_column(event.x)            col_id = ["num", "name", "speed", "time", "cycles", "nku", "total"][int(col.replace('#', '')) - 1]            old_title = self.col_headers[col_id]            new_title = simpledialog.askstring("–ó–∞–≥–æ–ª–æ–≤–æ–∫", f"–ù–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è '{old_title}':", initialvalue=old_title)            if new_title:                self.col_headers[col_id] = new_title                self.tree.heading(col, text=new_title)            return        elif region == "cell":            col = self.tree.identify_column(event.x)            row_id = self.tree.identify_row(event.y)            if row_id == "total" or not row_id: return            step = None            for s in self.steps:                if str(id(s)) == row_id: step = s; break            if not step: return            col_idx = int(col.replace('#', '')) - 1            key = ["num", "name", "speed", "time", "cycles", "nku", "total"][col_idx]            if key == "total": return            x, y, w, h = self.tree.bbox(row_id, col)            entry = tb.Entry(self.tree)            entry.place(x=x, y=y, width=w, height=h)                        val = str(step.get(key, ""))            entry.insert(0, val)            entry.select_range(0, tk.END)            entry.focus()            def save(e):                val = entry.get()                try:                    if key == "name": step["name"] = val                    elif key == "speed": step["speed"] = val                    elif key == "num": step["num"] = int(val)                    elif key == "cycles":                         c = int(float(val.replace(",", ".")))                        step["cycles"] = c if c > 0 else 1                    elif key in ["time", "nku"]:                         step[key] = parse_time_input(val)                                        step["total"] = (step["time"] + step["nku"]) * step["cycles"]                    entry.destroy()                    self.refresh_table()                    self.master.recalculate_totals()                except ValueError: pass            entry.bind("<Return>", save)            entry.bind("<FocusOut>", lambda e: entry.destroy())    def sort_col(self, col_key, reverse):        if col_key in ["time", "nku", "total", "cycles", "num"]:            self.steps.sort(key=lambda x: x.get(col_key, 0), reverse=reverse)        else:            self.steps.sort(key=lambda x: str(x.get(col_key, "")), reverse=reverse)        self.tree.heading(col_key, command=lambda: self.sort_col(col_key, not reverse))        self.refresh_table()    def refresh_table(self):        for i in self.tree.get_children(): self.tree.delete(i)        t_time, t_nku, t_grand = 0, 0, 0        for s in self.steps:            t_time += s['time'] * s['cycles']            t_nku += s['nku'] * s['cycles']            s['total'] = (s['time'] + s['nku']) * s['cycles']            t_grand += s['total']            if "speed" not in s: s["speed"] = ""            vals = (                s['num'], s['name'], s['speed'],                format_time_display(s['time']), s['cycles'],                 format_time_display(s['nku']), format_time_display(s['total'])            )            self.tree.insert("", "end", iid=str(id(s)), values=vals)        self.tree.insert("", "end", iid="total", values=(            "‚àë", "–û–ë–©–ò–ô –ò–¢–û–ì:", "", format_time_display(t_time),             "‚Äî", format_time_display(t_nku), format_time_display(t_grand)        ), tags=("total_row",))    def add_step_ui(self):        try: t = parse_time_input(self.var_add_t.get())        except ValueError:            messagebox.showerror("–û—à–∏–±–∫–∞", "–í—Ä–µ–º—è: 1:30 –∏–ª–∏ 1.5")            return        try:            c_str = self.var_add_c.get().replace(",", ".").strip()            c = int(float(c_str)) if c_str else 1            if c < 1: c = 1        except ValueError:            messagebox.showerror("–û—à–∏–±–∫–∞", "–¶–∏–∫–ª—ã: —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ")            return        try: nku = parse_time_input(self.var_add_nku.get())        except ValueError:            messagebox.showerror("–û—à–∏–±–∫–∞", "–ù–ö–£: 1:30 –∏–ª–∏ 1.5")            return                    name = self.var_add_name.get()        spd = self.var_add_spd.get()        max_num = 0        for s in self.steps:            if s['num'] > max_num: max_num = s['num']                step = {"num": max_num + 1, "name": name, "speed": spd, "time": t, "cycles": c, "nku": nku, "total": (t+nku)*c}        self.steps.append(step)        self.refresh_table()        self.master.recalculate_totals()    def delete_step(self):        sel = self.tree.selection()        if not sel or sel[0] == "total": return        obj_id = sel[0]        for i, s in enumerate(self.steps):            if str(id(s)) == obj_id: del self.steps[i]; break        self.refresh_table()        self.master.recalculate_totals()    def move_row(self, d):        sel = self.tree.selection()        if not sel or sel[0] == "total": return        obj_id = sel[0]        idx = -1        for i, s in enumerate(self.steps):            if str(id(s)) == obj_id: idx = i; break        if idx != -1:            new_idx = idx + d            if 0 <= new_idx < len(self.steps):                self.steps[idx], self.steps[new_idx] = self.steps[new_idx], self.steps[idx]                self.refresh_table()                self.tree.selection_set(str(id(self.steps[new_idx])))    def get_data(self): return self.steps    def set_data(self, d):         self.steps = d        for s in self.steps:            if "speed" not in s: s["speed"] = ""        self.refresh_table()    def get_total_hours(self): return sum(s['total'] for s in self.steps)        def load_custom_impacts(self):        if os.path.exists(CUSTOM_STEPS_FILE):            try:                with open(CUSTOM_STEPS_FILE, "r", encoding="utf-8") as f:                    for x in json.load(f):                        if x not in self.impact_types: self.impact_types.append(x)            except: pass    def save_new_impact_type(self):        val = self.var_add_name.get().strip()        if not val: return        if val not in self.impact_types:            self.impact_types.append(val)            self.cb_name['values'] = self.impact_types # –û–±–Ω–æ–≤–ª—è–µ–º UI            l = []            if os.path.exists(CUSTOM_STEPS_FILE):                try: with open(CUSTOM_STEPS_FILE, "r", encoding="utf-8") as f: l = json.load(f)                except: pass            if val not in l:                l.append(val)                with open(CUSTOM_STEPS_FILE, "w", encoding="utf-8") as f: json.dump(l, f, ensure_ascii=False)            messagebox.showinfo("OK", "–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –±–∞–∑—É!")class TestTimeModule(CalcModule):    key = "test_time"    title = "–ì—Ä–∞—Ñ–∏–∫ –∏—Å–ø—ã—Ç–∞–Ω–∏–π (–ü–°–ò/–ü–ò/–¢–¢)"    def __init__(self, app):        super().__init__(app)        self.var_product = tk.StringVar()        self.var_decimal = tk.StringVar(value="–ò–£–Ø–î.")        self.var_start = tk.StringVar(value=datetime.now().strftime("%d.%m.%Y %H:%M"))        self.var_end = tk.StringVar(value="‚Äî")        self.var_total_h = tk.StringVar(value="0—á 00–º")        self.tabs = {}    def build_ui(self, parent: tb.Frame) -> tb.Frame:        self.frame = tb.Frame(parent)                top = tb.Frame(self.frame, padding=5)        top.pack(fill="x")                fr_info = tb.Labelframe(top, text="–ò–∑–¥–µ–ª–∏–µ", padding=5)        fr_info.pack(side="left", fill="both", expand=True)        tb.Label(fr_info, text="–ò–∑–¥–µ–ª–∏–µ:").grid(row=0, column=0)        tb.Entry(fr_info, textvariable=self.var_product, width=25).grid(row=0, column=1, padx=5)        tb.Label(fr_info, text="–î–µ—Ü–∏–±–µ–ª—å–Ω—ã–π:").grid(row=1, column=0)        tb.Entry(fr_info, textvariable=self.var_decimal, width=20).grid(row=1, column=1, padx=5)        dash = tb.Frame(top, padding=5)         dash.pack(side="right", fill="both", padx=10)                c1 = tb.Frame(dash, bootstyle="success")         c1.pack(side="left", padx=2, fill="y")        f1 = tb.Frame(c1, padding=5, bootstyle="success")        f1.pack(fill="both")        tb.Label(f1, text="–ù–ê–ß–ê–õ–û", bootstyle="inverse-success", font=("Segoe UI", 8)).pack(anchor="w")        e_s = tb.Entry(f1, textvariable=self.var_start, width=16, font=("Consolas", 11))        e_s.pack(pady=2)        e_s.bind("<FocusOut>", lambda e: self.recalculate_totals())        c2 = tb.Frame(dash, bootstyle="info")        c2.pack(side="left", padx=2, fill="y")        f2 = tb.Frame(c2, padding=5, bootstyle="info")        f2.pack(fill="both", expand=True)        tb.Label(f2, text="–î–õ–ò–¢–ï–õ–¨–ù–û–°–¢–¨", bootstyle="inverse-info", font=("Segoe UI", 8)).pack(anchor="w")        tb.Label(f2, textvariable=self.var_total_h, bootstyle="inverse-info", font=("Consolas", 14, "bold")).pack(expand=True)        c3 = tb.Frame(dash, bootstyle="danger")        c3.pack(side="left", padx=2, fill="y")        f3 = tb.Frame(c3, padding=5, bootstyle="danger")        f3.pack(fill="both")        tb.Label(f3, text="–ö–û–ù–ï–¶", bootstyle="inverse-danger", font=("Segoe UI", 8)).pack(anchor="w")        tb.Label(f3, textvariable=self.var_end, bootstyle="inverse-danger", font=("Consolas", 12, "bold")).pack(pady=5)        self.notebook = ttk.Notebook(self.frame)        self.notebook.pack(fill="both", expand=True, padx=5, pady=5)                self.add_tab("–ü–°–ò")        self.add_tab("–ü–ò")        self.add_tab("–¢–¢")                self.plus_frame = tb.Frame(self.notebook)        self.notebook.add(self.plus_frame, text=" [ + ] ")        self.notebook.bind("<<NotebookTabChanged>>", self.on_tab_change)        bot = tb.Frame(self.frame, padding=5)        bot.pack(fill="x")        tb.Button(bot, text="üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç", command=self.save_project, bootstyle="primary").pack(side="right")        tb.Button(bot, text="üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å", command=self.load_project, bootstyle="secondary").pack(side="right", padx=10)                if EXCEL_AVAILABLE:            tb.Button(bot, text="üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel", command=self.export_excel, bootstyle="success").pack(side="right", padx=10)        else:            tb.Label(bot, text="(–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ openpyxl –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞)", bootstyle="warning").pack(side="right", padx=10)        return self.frame    def add_tab(self, name):        if name in self.tabs: return        t = TestScheduleTab(self.notebook, name, self)        self.tabs[name] = t        try:            self.notebook.forget(self.plus_frame)            self.notebook.add(self.plus_frame, text=" [ + ] ")        except: pass    def on_tab_change(self, event):        sel = self.notebook.select()        if not sel: return        idx = self.notebook.index(sel)        if " [ + ] " in self.notebook.tab(idx, "text"):            new_name = simpledialog.askstring("–ù–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞", "–ù–∞–∑–≤–∞–Ω–∏–µ:")            if new_name:                self.add_tab(new_name)                self.notebook.select(self.notebook.index("end") - 2)            else:                self.notebook.select(0)    def recalculate_totals(self):        grand = 0.0        for t in self.tabs.values(): grand += t.get_total_hours()        self.var_total_h.set(format_time_display(grand))        try:            s = datetime.strptime(self.var_start.get(), "%d.%m.%Y %H:%M")            fin = s + timedelta(hours=grand)            self.var_end.set(fin.strftime("%d.%m.%Y %H:%M"))        except: self.var_end.set("–û—à–∏–±–∫–∞ –¥–∞—Ç—ã")    def save_project(self):        data = {            "ver": 3,            "product": self.var_product.get(),            "decimal": self.var_decimal.get(),            "start": self.var_start.get(),            "tabs": {k: v.get_data() for k,v in self.tabs.items()}        }        path = filedialog.asksaveasfilename(defaultextension=".json", filetypes=[("Project", "*.json")])        if path:            with open(path, "w", encoding="utf-8") as f: json.dump(data, f, indent=2, ensure_ascii=False)            messagebox.showinfo("OK", "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ")    def load_project(self):        path = filedialog.askopenfilename()        if not path: return        try:            with open(path, "r", encoding="utf-8") as f: data = json.load(f)            self.var_product.set(data.get("product", ""))            self.var_decimal.set(data.get("decimal", ""))            self.var_start.set(data.get("start", ""))            for name, steps in data.get("tabs", {}).items():                if name not in self.tabs: self.add_tab(name)                self.tabs[name].set_data(steps)            self.recalculate_totals()            messagebox.showinfo("OK", "–ó–∞–≥—Ä—É–∂–µ–Ω–æ")        except Exception as e:            messagebox.showerror("Err", str(e))                def export_excel(self):        if not EXCEL_AVAILABLE:            messagebox.showerror("–û—à–∏–±–∫–∞", "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ openpyxl –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.\n–í—ã–ø–æ–ª–Ω–∏—Ç–µ: pip install openpyxl")            return                    path = filedialog.asksaveasfilename(defaultextension=".xlsx", filetypes=[("Excel", "*.xlsx")])        if not path: return                try:            wb = openpyxl.Workbook()            # –£–¥–∞–ª—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ª–∏—Å—Ç            if "Sheet" in wb.sheetnames:                del wb["Sheet"]                            header_font = Font(bold=True)            border = Border(left=Side(style='thin'), right=Side(style='thin'), top=Side(style='thin'), bottom=Side(style='thin'))            fill_gray = PatternFill("solid", fgColor="DDDDDD")            for tab_name, tab_obj in self.tabs.items():                ws = wb.create_sheet(title=tab_name[:30]) # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –∏–º–µ–Ω–∏ –ª–∏—Å—Ç–∞                                # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ò–∑–¥–µ–ª–∏—è                ws["A1"] = f"–ò–∑–¥–µ–ª–∏–µ: {self.var_product.get()}"                ws["A2"] = f"–î–µ—Ü–∏–±–µ–ª—å–Ω—ã–π ‚Ññ: {self.var_decimal.get()}"                ws["A3"] = f"–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç: {self.var_start.get()}"                                # –®–∞–ø–∫–∞ —Ç–∞–±–ª–∏—Ü—ã                headers = ["‚Ññ", "–í–∏–¥ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è", "–°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞", "–í—Ä–µ–º—è (—á)", "–¶–∏–∫–ª—ã", "–ù–ö–£ (—á)", "–ò—Ç–æ–≥–æ (—á)"]                ws.append([]) # –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞                ws.append(headers)                                # –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —à–∞–ø–∫–∏                for cell in ws[5]: # 5-—è —Å—Ç—Ä–æ–∫–∞ (1-3 –∏–Ω—Ñ–æ, 4 –ø—É—Å—Ç–∞—è, 5 —à–∞–ø–∫–∞)                    cell.font = header_font                    cell.border = border                    cell.fill = fill_gray                                # –î–∞–Ω–Ω—ã–µ                row_idx = 6                grand_total = 0                for step in tab_obj.steps:                    row = [                        step.get("num", ""),                        step.get("name", ""),                        step.get("speed", ""),                        step.get("time", 0),                        step.get("cycles", 1),                        step.get("nku", 0),                        step.get("total", 0)                    ]                    grand_total += step.get("total", 0)                    ws.append(row)                                        # –ì—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —è—á–µ–µ–∫                    for cell in ws[row_idx]:                        cell.border = border                    row_idx += 1                                # –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞                ws.append(["", "–û–ë–©–ò–ô –ò–¢–û–ì", "", "", "", "", grand_total])                for cell in ws[row_idx]:                    cell.font = header_font                    cell.border = border                                # –®–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫                ws.column_dimensions["A"].width = 5                ws.column_dimensions["B"].width = 40                ws.column_dimensions["C"].width = 15                ws.column_dimensions["D"].width = 10                ws.column_dimensions["E"].width = 8                ws.column_dimensions["F"].width = 10                ws.column_dimensions["G"].width = 12            wb.save(path)            messagebox.showinfo("–£—Å–ø–µ—Ö", "–¢–∞–±–ª–∏—Ü–∞ —É—Å–ø–µ—à–Ω–æ –≤—ã–≥—Ä—É–∂–µ–Ω–∞ –≤ Excel!")                    except Exception as e:            messagebox.showerror("–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞", str(e))